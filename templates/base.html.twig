<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    {# Désactive l'affichage des snapshots Turbo pendant la navigation pour éviter tout écrasement de saisie #}
    <meta name="turbo-cache-control" content="no-preview">
    <title>{% block title %}Arkemis — Simulateurs{% endblock %}</title>

    {# Material Icons #}
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    {# Materialize CSS est désormais compilé via Vite #}

    {% block stylesheets %}
        {{ vite_entry_link_tags('styles') }}
    {% endblock %}
    <script>
        // Applique la classe de thème le plus tôt possible pour éviter le flash
        (function() {
            try {
                var lsKey = 'arkemis-theme';
                var saved = localStorage.getItem(lsKey);
                var initial = saved || (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
                if (initial === 'light') document.documentElement.classList.add('theme-light');
                else document.documentElement.classList.add('theme-dark');
                document.documentElement.setAttribute('data-theme', initial);
            } catch (e) { /* no-op */ }
        })();
    </script>
</head>
<body>
    <!-- Topbar minimal (logo + burger) -->
    <nav class="navbar" id="navbar" data-turbo-permanent>
        <div class="nav-wrapper">
            <!-- Burger: mobile = ouvre la sidenav (Materialize), desktop = collapse/expand par CSS -->
            <a href="#" data-target="sidenav-main" class="sidenav-trigger js-sidenav-toggle" aria-label="Basculer la navigation" data-turbo="false"><i class="material-icons">menu</i></a>
            <a href="{{ path('app_home') }}" class="brand-logo">
                <span class="logo" role="img" aria-label="Arkemis"></span>
            </a>
            <div class="nav-spacer"></div>
            <!-- Bouton thème (même gabarit que le burger, à droite) -->
            <a href="#" class="js-theme-toggle nav-icon" role="button" aria-label="Basculer le thème" title="Basculer le thème" data-turbo="false" aria-pressed="false">
                <i class="material-icons js-theme-icon" aria-hidden="true">brightness_6</i>
            </a>
        </div>
    </nav>

    <!-- Sidebar (fixe sur desktop, drawer sur mobile) -->
    <ul class="sidenav sidenav-fixed" id="sidenav-main" data-turbo-permanent>
        <li class="{% if app.request.attributes.get('_route') starts with 'app_home' %}active{% endif %}">
            <a href="{{ path('app_home') }}" class="waves-effect sidenav-close">
                <i class="material-icons">dashboard</i>
                Accueil
            </a>
        </li>
        <li>
            {% set currentRoute = app.request.attributes.get('_route') %}
            {% set isSimu = currentRoute starts with 'app_simulators_' %}
            <ul class="collapsible collapsible-accordion">
                <li class="{% if isSimu %}active{% endif %}">
                    <a class="collapsible-header waves-effect{% if isSimu %} active{% endif %}">
                        <i class="material-icons">calculate</i>
                        Simulateurs
                        <i class="material-icons right">arrow_drop_down</i>
                    </a>
                    <div class="collapsible-body" {% if isSimu %}style="display:block"{% endif %}>
                        <ul>
                            <li class="{% if currentRoute == 'app_simulators_mortgage' %}active{% endif %}">
                                <a class="sidenav-close" href="{{ path('app_simulators_mortgage') }}">
                                    <i class="material-icons">home</i>
                                    Crédit immobilier
                                </a>
                            </li>
                            <li class="{% if currentRoute == 'app_simulators_primary_residence' %}active{% endif %}">
                                <a class="sidenav-close" href="{{ path('app_simulators_primary_residence') }}">
                                    <i class="material-icons">family_restroom</i>
                                    Résidence principale
                                </a>
                            </li>
                            <li class="{% if currentRoute == 'app_simulators_rental_investment' %}active{% endif %}">
                                <a class="sidenav-close" href="{{ path('app_simulators_rental_investment') }}">
                                    <i class="material-icons">apartment</i>
                                    Investissement locatif
                                </a>
                            </li>
                            <li class="{% if currentRoute == 'app_simulators_stock_investment' %}active{% endif %}">
                                <a class="sidenav-close" href="{{ path('app_simulators_stock_investment') }}">
                                    <i class="material-icons">trending_up</i>
                                    Placement en bourse
                                </a>
                            </li>
                            <li class="{% if currentRoute == 'app_simulators_rent_plus_invest' %}active{% endif %}">
                                <a class="sidenav-close" href="{{ path('app_simulators_rent_plus_invest') }}">
                                    <i class="material-icons">savings</i>
                                    Louer + investir l'apport
                                </a>
                            </li>
                            <li class="divider" tabindex="-1"></li>
                            <li class="{% if currentRoute == 'app_simulators_buy_vs_rent' %}active{% endif %}">
                                <a class="sidenav-close" href="{{ path('app_simulators_buy_vs_rent') }}">
                                    <i class="material-icons">compare_arrows</i>
                                    Acheter vs Louer
                                </a>
                            </li>
                        </ul>
                    </div>
                </li>
            </ul>
        </li>
    </ul>

    <!-- Contenu -->
    <div class="app-content">
        <main class="container">
            {% block body %}{% endblock %}
        </main>

        <!-- Footer (ligne unique, centré) -->
        <footer class="page-footer">
            <div class="container footer-content center-align">
                <span>Arkemis</span>
                <span class="footer-separator">•</span>
                <span>Outils de simulation patrimoniale</span>
                <span class="footer-separator">•</span>
                <span>© {{ "now"|date('Y') }} Arkemis</span>
            </div>
        </footer>
    </div>

    <!-- JS: Materialize + app.js via Vite -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script>
        (function initMaterializeAuto() {
            function boot() {
                if (window.M && typeof M.AutoInit === 'function') {
                    M.AutoInit();
                }
            }
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', boot, { once: true });
            } else {
                boot();
            }
        })();
    </script>
    {% block javascripts %}
        {{ vite_entry_script_tags('app') }}
    {% endblock %}
</body>
</html>
